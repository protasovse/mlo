{% extends 'front/base.html' %}
{% load static %}
{% load markdown %}

{% block title %}{{ question.title }} — вопрос №{{ question.id }} на Мойюрист.онлайн{% endblock %}

{% block og_meta %}
    <meta property="og:title" content="{{ question.title }} — вопрос №{{ question.id }} на Мойюрист.онлайн"/>
    <meta property="og:description"
          content="Вопрос №{{ question.id }} на Мойюрист.онлайн, ответов: {{ question.reply_count }}.{% if question.rubric %} Тема «{{ question.rubric }}».{% endif %}"/>
    <meta property="og:image" content="{% static 'img/logo_sq.png' %}"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="{{ SITE_URL }}{{ question.get_absolute_url }}"/>
{% endblock %}

{% block head %}
    <link rel="canonical" href="{{ SITE_URL }}{{ question.get_absolute_url }}">
    <meta name="robots" content="index,follow">
{% endblock %}

{% block content %}

    {# Хедер страницы вопроса #}
    {% include 'question/section/header_question.html' with bg_class='bg-1' %}

    {# Хлебные крошки #}
    <div class="question-page_container">
        <div class="row">
            <nav class="col-12">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'questions:list' %}">Вопросы</a></li>
                    <li class="breadcrumb-item active"><a
                            href="{{ question.rubric.get_absolute_url }}">{{ question.rubric }}</a></li>
                </ol>
            </nav>
        </div>
    </div>

    {# Содержание страницы вопроса #}
    <div class="question-page_container">

        {# Вопрос и правая колонка напротив вопроса  #}
        <div class="row pb-4">

            {# Центральная часть — вопрос #}
            <div class="question-page_main-part">

                {# Вопрос #}
                <article id="question-{{ question.id }}" class="entry" itemscope itemtype="http://schema.org/Question">

                    {% for message in mess %}
                        <div class="alert alert-{{ message.tags }}" role="alert">
                            {% autoescape off %}
                                {{ message }}
                            {% endautoescape %}
                        </div>
                    {% endfor %}

                    {# Заголовок #}
                    <h1 class="h2 mb-5" itemprop="name">{{ question.title }}</h1>

                    {# Инфо, текст #}
                    <div class="row">

                        <div class="question-page_l-col">
                            <time class="subtitle d-block mt-1" datetime="{{ question.pub_date|date:"c" }}"
                                  itemprop="dateCreated">{{ question.pub_date|date:"j M Y G:i" }}</time>
                            <span class="d-block">№ {{ question.id }}</span>
                            <span class="d-block">{{ question.author.city.name }}</span>
                        </div>

                        <div class="question-page_r-col mb-4">

                            {# Имя #}
                            <h5 itemprop="author" itemscope itemtype="http://schema.org/Person"
                                class="my-3 mb-lg-1 mt-lg-0" data-user_id="{{ question.author.pk }}"><span
                                    itemprop="name">{{ question.author.get_name }}</span></h5>

                            {# Текст #}
                            <div class="lead" itemprop="text">{{ question.html_content|safe }}</div>

                            {# Файлы #}
                            {% if question.files.all|length %}
                                <div class="alert alert-secondary">
                                    {% for file in question.files.all %}
                                        <p class="file-list-item">
                                            <a target="_blank"
                                               href="/storage/{{ file.file }}">{{ file.get_basename }}</a>
                                        </p>
                                    {% endfor %}
                                </div>
                            {% endif %}

                            {# Блок ответить на вопрос #}
                            {% if question.is_pay %}
                                {# Если консультация платная #}
                                {% include 'advice/advice_question_answer_block.html' %}
                            {% endif %}
                            {% comment %}
                            {% elif user.role == 2 %}
                                {#% include 'question/question_answer_block.html' %#}
                                {% if not is_my_answer %}{% endif %}
                            {% endif %}
                            {% endcomment %}

                            <!--hr class="my-4"-->

                            {# Яндекс share кнопки #}
                            {#% include 'front/generic/yandex-share.html' %#}

                            {# Рубрики #}
                            {% if question.rubric %}
                                <div class="rubrics-list mt-4">
                                    <span class="rubrics-list-item"><a
                                            href="{{ question.rubric.get_absolute_url }}">{{ question.rubric }}</a></span>
                                </div>
                            {% endif %}

                            {% if question.reply_count == 0 %}
                            {% if not user.is_authenticated %}
                                <div class="small text-muted mt-4"><hr>На этот вопрос юрист ещё не ответил. Если вы знаете
                                ответ, то можете <a class="text-dark" href="/auth/registration/" >зарегистрироваться</a>
                                в качестве эксперта и ответить на него.</div>
                                {% elif user == question.author and not question.is_pay %}
                                <div class="small text-muted mt-4"><hr>На ваш вопрос юрист ещё не ответил. К сожалению,
                                на бесплатный вопрос мы не даём гарантии ответа. Если вам нужна развернутая
                                гаратированная консультация, <a class="text-dark" href="{% url 'ask_question' %}">задайте
                                вопрос</a> платно.</div>
                                {% endif %}
                            {% endif %}

                        </div>

                    </div>

                </article>

            </div>

            {# Боковая колонка 1  #}
            <aside class="question-page_aside-part pt-3">

                {% if question.is_pay %}
                    {# Если консультация платная #}
                    {% include 'advice/aside/advice_status.html' with advice_context=advice_context %}

                {% elif lawyers_from_rating.count %}
                    {% comment %}
                    <h4 class="mb-4">Наши эксперты</h4>
                    {% include 'rating/aside/best_lawyers.html' with items=lawyers_from_rating %}
                    {% endcomment %}
                {% endif %}

            </aside>

        </div>

        {# Если есть ответы  #}
        <div id="answer">
            <router-view>
                <div class="row question-page_gradient py-5">
                    <div class="question-page_main-part">
                        {# Основная часть — ответы #}
                        {# Ответы #}
                        <div class="row">
                            <h3 class="answer-list-head col offset-lg-1">Ответы юристов <span class="answer__counter"
                                                                                              itemprop="answerCount">{{ question.reply_count }}</span>
                            </h3>
                        </div>
                        {% for answer in answers %}
                            {% include 'entry/generic/answer_item.html' with item=answer %}
                        {% endfor %}

                    </div>
                    {# Боковая колонка 2  #}
                    <aside class="question-page_aside-part">
                        {% comment %}
                        {% if question.reply_count %}
                            <h4 class="mb-4">Все ответы экспертов на этот вопрос:</h4>
                            {% include 'question/aside/answer_lawyers_others.html' with items=answers %}
                        {% endif %}
                        {% endcomment %}
                    </aside>
                </div>
            </router-view>
        </div>

        {% if similar_questions %}
            <div class="row question-page_gradient py-5">
                <div class="question-page_main-part">
                    <div class="row">
                        <h3 class="answer-list-head col offset-lg-1">Похожие вопросы</h3>
                    </div>
                    <hr>
                    {% for item in similar_questions %}
                        {% include 'question/generic/question_item_in_list.html' with item=item show_answers=False %}
                    {% endfor %}
                </div>
            </div>
        {% endif %}

    </div>

    {#% include 'question/section/not_found_answer.html' %#}

{% endblock %}

{% block block_js %}
    {#  если не авторизован - не грузить этот скрипт #}
    <script src='{% static "answer_question.js" %}'></script>
    {% if user.role != 2 %}{% include 'front/widgets/consult.html' %}{% endif %}
{% endblock %}
